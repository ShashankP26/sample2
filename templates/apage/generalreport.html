{% extends "base.html" %}

{% block content %}
<div class="page-header d-print-none">
  <div class="container-fluid">
    <div class="row g-2 align-items-center">
      <div class="col">
        <h2 class="page-title ">GENERAL REPORT</h2>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid mt-5">
  <div class="page-body">
    <!-- Search Card -->
    <div class="row row-cards mb-4">
      <div class="col-md-3 mr-3">
        <a href="{% url 'generalreport' %}" class="btn btn-primary">View All Reports</a>
      </div>
    </div>
    <div class="row row-cards">
      <div class="col-12">
        <form action="{% url 'generalreportsnew' %}" method="POST" class="card" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="card-body">
            <!-- Site Selection and Date of Visit -->
            <div class="mb-3 row g-3">
              <div class="col-md-6">
                <label for="site" class="form-label">SITE</label>
                <select id="site" name="site" class="form-select is-valid" required>
                  <option value="" disabled selected>Select a site</option>
                  {% for site in sites %}
                  <option value="{{ site.id }}">{{ site.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-6">
                <label for="date-of-visit" class="form-label">DATE OF VISIT</label>
                <input type="date" id="date-of-visit" name="date_of_visit" class="form-control" required>
                <div id="date-error" class="text-danger" style="display: none;">Future dates are not allowed. "Data Will Not Be Stored"</div>

              </div>
            </div>

            <!-- Points Section -->
            <div class="mb-3">
              <label class="form-label">POINTS</label>
              <div class="row g-3">
                <div class="col-md-6">
                  <input type="text" class="form-control mb-2" name="point1" placeholder="Point 1">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control mb-2" name="point2" placeholder="Point 2">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control mb-2" name="point3" placeholder="Point 3">
                </div>
                <div class="col-md-6">
                  <input type="text" class="form-control mb-2" name="point4" placeholder="Point 4">
                </div>
              </div>
            </div>

            <!-- Notes Section -->
            <div class="mb-3">
              <label for="notes" class="form-label">NOTES</label>
              <textarea id="notes" name="notes" class="form-control" rows="3"></textarea>
            </div>

            <!-- Attachment Section -->
            <div class="mb-3">
              <label for="attachment" class="form-label">ATTACHMENT</label>
              <input type="file" id="attachment" name="attachment" class="form-control">
            </div>
          </div>

          <!-- Submit and Reset Buttons -->
          <div class="card-footer text-end">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button type="reset" class="btn btn-secondary">Reset</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("JavaScript Loaded");
    const dateInput = document.getElementById("date-of-visit");
    const errorDiv = document.getElementById("date-error");

    dateInput.addEventListener("change", function () {
      const selectedDate = new Date(dateInput.value);
      const today = new Date();
      today.setHours(0, 0, 0, 0);  // Set today's time to 00:00:00 for comparison
  
      if (selectedDate > today) {
          errorDiv.style.display = "block";
          dateInput.classList.add("is-invalid");
      } else {
          errorDiv.style.display = "none";
          dateInput.classList.remove("is-invalid");
      }
  });  
});
</script>
{% endblock %}