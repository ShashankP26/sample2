{% extends 'base.html' %}

{% block content %}
<div class="container-fluid">
    <h2 class="mb-4 mt-4 text-center">Pay Now - {{ selected_user.username }}</h2>

    <div class="card">
        <div class="card-body">
            <form id="paymentForm" method="post" action="{% url 'process_payment' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <input type="hidden" name="user_id" value="{{ selected_user.id }}">
                <input type="hidden" name="total_amount_to_be_paid" value="{{ total_amount_to_be_paid }}">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th class="col-12 col-md-2">Transaction ID</th>
                                <th class="col-12 col-md-2">User(Pay To)</th>
                                <th class="col-12 col-md-2">Total Amount</th>
                                <th class="col-12 col-md-2">From</th>
                                <th class="col-12 col-md-2">To</th>
                                <th class="col-12 col-md-2">Remark</th>
                                <th class="col-12 col-md-2">Screenshot (Upload Proof)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <!-- Transaction ID -->
                                <td class="col-12 col-md-2">
                                    <input type="text" id="transactionId" name="transaction_id" class="form-control" value="{{ transaction_id }}" required readonly>
                                </td>
                                
                                <!-- Selected User -->
                                <td class="col-12 col-md-2">
                                    <input type="text" name="selected_user" class="form-control" value="{{ selected_user.username }}" required readonly>
                                </td>
                            
                                <!-- Amount -->
                                <td class="col-12 col-md-2">
                                    <input type="number" name="amount" class="form-control" value="{{ final_amount_to_pay }}" required readonly>
                                </td>
                            
                                <!-- From Date -->
                                <td class="col-12 col-md-2">
                                    <input type="date" name="from_date" class="form-control" value="{{ from_date }}" readonly>
                                </td>
                            
                                <!-- To Date -->
                                <td class="col-12 col-md-2">
                                    <input type="date" name="to_date" class="form-control" value="{{ to_date }}" readonly>
                                </td>
                                <td class="col-12 col-md-2">
                                    <input type="text"
                                           name="remarks"
                                           class="form-control"
                                           placeholder="Optional remarks"
                                           required>
                                </td>


                            
                                <!-- Screenshot -->
                                <td class="col-12 col-md-3">
                                    <input type="file" name="screenshot" class="form-control" required>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="d-flex flex-wrap justify-content-between mt-3">
                    <button type="button" id="submitButton" class="btn btn-success me-2 mb-2">Submit Payment</button>
                    <a href="javascript:history.back()" class="btn btn-primary mb-2">Back</a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript to handle confirmation -->
<style>
    @media (max-width: 767px) {
        td {
            width: 100%;  /* Ensure the column takes up the entire width */
        }
    
        /* Adjust the form controls to take full width on mobile */
        .form-control {
            width: 100%;
            font-size: 14px;  /* Optional: reduce font size for better visibility on smaller screens */
            padding: 10px;    /* Optional: adjust padding if needed */
        }
    }
</style>

<script>
    document.getElementById('submitButton').addEventListener('click', function () {
        // Get the transaction ID from the input field
        const transactionId = document.getElementById('transactionId').value;

        // Show confirmation popup
        const confirmation = confirm(`Are you sure you want to submit the payment with Transaction ID: ${transactionId}?`);

        // If confirmed, submit the form
        if (confirmation) {
            document.getElementById('paymentForm').submit();
        }
    });
</script>
{% endblock %}