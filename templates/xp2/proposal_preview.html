{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quotation Preview - {{ quotation_number }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: #f8f9fb;
    color: #19202A;
    margin: 0;
}
header {
    text-align: center;
    padding: 32px 0 0 0;
    background: #fff;
    border-bottom: 1.5px solid #e5e5e5;
}
.logo {
    height: 38px;
}
.container {
    max-width: 900px;
    margin: 32px auto 0 auto;
    background: #fff;
    border-radius: 7px;
    box-shadow: 0 2px 12px 0 rgba(0,0,0,0.04);
    padding: 36px 36px 30px 36px;
    min-height: 80vh;
}
h1, h2, h3, h4 {
    text-align: left;
    margin: 0 0 18px 0;
}
h1 { font-size: 2rem; font-weight: 600; margin-bottom: 28px; }
h2 { font-size: 1.3rem; font-weight: 600; margin-top: 1.7em; }
h3 { font-size: 1.13rem; font-weight: 600; margin-top: 1.4em;}
h4 { font-size: 1.06rem; font-weight: 600; margin-top: 1em;}
.company-block {
    margin-bottom: 18px;
}
.company-block .cname {
    font-weight: 600;
    font-size: 1.13rem;
}
.company-block .cmail {
    font-size: 1rem;
    color: #355;
}
.info-table {
    width: 100%;
    max-width: 480px;
    margin: 15px 0 28px 0;
    border: 1px solid #e2e6ef;
    border-radius: 4px;
    border-collapse: collapse;
    font-size: 15px;
}
.info-table td {
    border-bottom: 1px solid #eaeaea;
    padding: 7px 13px;
}
.info-table td:first-child {
    background: #f7f8fa;
    font-weight: 500;
    width: 36%;
}
.info-table tr:last-child td { border-bottom: none; }
.section-title {
    font-size: 1.13rem;
    font-weight: 600;
    background: #f5f7fa;
    border-radius: 5px 5px 0 0;
    border-bottom: 1.5px solid #e4e7ea;
    padding: 9px 0 7px 15px;
    margin: 2.2em 0 1em 0;
    letter-spacing: 0.04em;
}
.details-section {
    margin-bottom: 18px;
    padding-left: 2px; padding-right:2px;
}
ul, ol { margin: 2px 0 0 18px; font-size: 1em; }
li { margin-bottom: 3.5px; font-size: 1em; }
.styled-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 14px;
    font-size: 15px;
}
.styled-table th, .styled-table td {
    border: 1px solid #dde2e7;
    padding: 9px 7px;
    text-align: center;
}
.styled-table th {
    background: #f5f7fa;
    font-weight: 600;
}
.styled-table td { font-weight: 400; }
.styled-table tbody tr:nth-child(even) { background: #fafbfc; }
.print-button {
    padding: 9px 23px;
    margin-top: 14px;
    background: #2234c9;
    border: none;
    border-radius: 20px;
    font-size: 1.01rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.18s;
}
.print-button:hover { background: #1a247d; }
footer {
    text-align: center;
    font-size: 12px;
    margin: 38px 0 0 0;
}
hr {
    border: none;
    height: 1.5px;
    background: #e5e8ee;
    margin: 31px 0 25px 0;
}
@media print {
    body, .container, .details-section, .company-block {
        background: #fff !important;
        color: #222 !important;
    }
    .container {
        box-shadow: none !important;
        border-radius: 0 !important;
        padding: 0 !important;
        margin: 0 !important;
    }
    header { border: none; }
    .styled-table th {
        background: #f5f7fa !important;
        color: #242F3A !important;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    .section-title {
        background: #f5f7fa !important;
        color: #111 !important;
        border-radius: 5px 5px 0 0 !important;
        border-bottom: 1.5px solid #e4e7ea !important;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }
    .print-button { display: none !important; }
}
</style>
</head>
<body>
<header>
    <img src="{% static 'xlogo.png' %}" width="130" height="40" alt="Xpredict" class="logo">
</header>


<div class="container">
    <h2>Proposal Details</h2>
    {% for comp in company %}
        <div class="company-block">
            <div class="cname">{{ comp.c_name }}</div>
            <div class="cmail">{{ comp.mail }} / {{ comp.phone }} </div>
        </div>
        <table class="info-table">
            <tbody>
                <tr>
                    <td>Date</td>
                    <td>{{ current_date }}</td>
                </tr>
                <tr>
                    <td>Quotation No</td>
                    <td>{{ quotation_no }}</td>
                </tr>
                <tr>
                    <td>Validity</td>
                    <td>15 days</td>
                </tr>
                <tr>
                    <td>Prepared by</td>
                    <td>Kirti</td>
                </tr>
            </tbody>
        </table>
    {% endfor %}

    {% if has_contents %}
    <div class="details-section">
        <div class="section-title">Contents</div>
        <ul>
        {% for cont in data.contents %}
            <li>{{ cont.value }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if has_site_info %}
    <div class="details-section">
        <div class="section-title">Site Information</div>
        <ul>
        {% for item in data.site_info %}
            {% if item.is_checked %}
            <li>{{ item.info_text }}</li>
            {% endif %}
            {% if item.is_standard_checked %}
            <li>{{ item.standard_text }}</li>
            {% endif %}
        {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if has_raw_sewage %}
    <div class="details-section">
        <div class="section-title">Raw Sewage Characteristics</div>
        <table class="styled-table">
        <thead>
            <tr>
                <th>Sl. No</th>
                <th>Raw Sewage Characteristics</th>
                <th>Unit</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
        {% for t1 in data.table_data %}
            {% if t1.is_checked %}
            <tr>
                <td>{{ t1.sl_no }}</td>
                <td>{{ t1.raw_sewage_characteristics }}</td>
                <td>{{ t1.unit }}</td>
                <td>{{ t1.value }}</td>
            </tr>
            {% endif %}
        {% endfor %}
        </tbody>
        </table>
    </div>
    {% endif %}

    {% if has_treatment %}
    <div class="details-section">
        <div class="section-title">Treatment Processes and Purpose</div>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Principal Purpose Unit Process</th>
                    <th>Unit Processes</th>
                </tr>
            </thead>
            <tbody>
            {% for treat in data.treatment_processes %}
                {% if treat.is_checked %}
                <tr>
                    <td>{{ treat.principal_purpose_unit_process }}</td>
                    <td>{{ treat.unit_processes }}</td>
                </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if has_obs_sugg %}
    <div class="details-section">
        <div class="section-title">Observations and Suggestions</div>
        <h4>Observations</h4>
        <ul>
        {% for obs in data.observations_and_suggestions %}
            {% if obs.observation_checked %}
                <li>{{ obs.observation }}</li>
            {% endif %}
        {% endfor %}
        </ul>
        <h4>Suggestions</h4>
        <ul>
        {% for obs in data.observations_and_suggestions %}
            {% if obs.suggestion_checked %}
                <li>{{ obs.suggestion }}</li>
            {% endif %}
        {% endfor %}
        </ul>
        {% for obs in data.observations_and_suggestions %}
            {% if obs.features %}
                <h3 class="mt-4">HIDREC Features and Advantages</h3>
                <div>{{ obs.features|linebreaksbr }}</div>
            {% endif %}
            {% if obs.salient %}
                <h3 class="mt-4">Salient features</h3>
                <div>{{ obs.salient|linebreaksbr }}</div>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    {% if has_requirements %}
    <div class="details-section">
        <div class="section-title">Requirements and Specifications</div>
        <ul>
        {% for req in data.requirements_and_specifications %}
            {% if req.requirement_checked %}
                <li>{{ req.requirement_text }}</li>
            {% endif %}
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    {% if has_specs %}
    <div class="details-section">
        <div class="section-title">Specs</div>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Specs for 25 KLD</th>
                    <th>HIDREC</th>
                </tr>
            </thead>
            <tbody>
            {% for spec in data.specifications %}
                {% if spec.spec_checked %}
                    <tr>
                        <td>{{ spec.specs_for_25kld }}</td>
                        <td>{{ spec.hidrec }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if has_process_diagram %}
    <div class="details-section">
      <div class="section-title">Process Diagram</div>
      <ul>
        {% for pro in data.process_diagram %}
          {% if pro.process_diagram_checked %}
            {% if pro.req_text %}
              <li>{{ pro.req_text }}</li>
            {% endif %}
  
            {% if pro.process_diagram1_path %}
              <li>
                <img src="/static/{{ pro.process_diagram1_path }}" alt="Diagram 1" width="280" height="280"
                     onerror="this.onerror=null;this.src='https://via.placeholder.com/280?text=Missing+Image';">
              </li>
            {% endif %}
  
            {% if pro.process_diagram2_path %}
              <li>
                <img src="/static/{{ pro.process_diagram2_path }}" alt="Diagram 2" width="280" height="280"
                     onerror="this.onerror=null;this.src='https://via.placeholder.com/280?text=Missing+Image';">
              </li>
            {% endif %}
          {% endif %}
        {% endfor %}
      </ul>
    </div>
  {% endif %}
    
    {% if has_process_desc %}
    <div class="details-section">
        <div class="section-title">Process Description</div>
        {% for des in data.process_description %}
            {% if des.process_data.process_description_checked %}
                <p>{{ des.process_data.process_description }}</p>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    {% if has_output %}
    <div class="details-section">
        <div class="section-title">Output Treated Water Quality as per KSPCB</div>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Sl</th>
                    <th>Treated Water Characteristics</th>
                    <th>Unit</th>
                    <th>Standard Value as per KSPCB</th>
                </tr>
            </thead>
            <tbody>
            {% for outt in data.output_table %}
                {% if outt.output_data.is_checked %}
                <tr>
                    <td>{{ outt.output_data.sl_no }}</td>
                    <td>{{ outt.output_data.treated_water_characteristics }}</td>
                    <td>{{ outt.output_data.unit }}</td>
                    <td>{{ outt.output_data.standard_value }}</td>
                </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
        <div style="margin-top: 20px;">
            <h4>Sludge Handling System</h4>
            {% for des in data.process_description %}
                {% if des.process_data.process_description_checked %}
                    <p>{{ des.shs_text }}</p>
                {% endif %}
            {% endfor %}
            <h4>Automation</h4>
            {% for des in data.process_description %}
                {% if des.is_checked %}
                    <p>{{ des.automation_text }}</p>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {% if has_pricing %}
    <div class="details-section">
        <div class="section-title">Pricing: Machine Costs</div>
        <ul>
        {% for pri in data.pricing %}
            {% if pri.is_checked %}
                <li>{{ pri.machine_cost_text }}</li>
            {% endif %}
        {% endfor %}
        </ul>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Product on Offer</th>
                    <th>Capacity</th>
                    <th>Total Needed Capacity</th>
                    <th>Wastewater Type</th>
                    <th>Total Number of Machines</th>
                </tr>
            </thead>
            <tbody>
            {% for instal in data.installation %}
                {% if instal.is_checked %}
                    <tr>
                        <td>{{ instal.product_name }}</td>
                        <td>{{ instal.capacity }}</td>
                        <td>{{ instal.total_needed_capacity }}</td>
                        <td>{{ instal.waste_water_type }}</td>
                        <td>{{ instal.total_no_machines }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if has_specification %}
    <div class="details-section">
        <div class="section-title">Specification Pricing</div>
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Sl</th>
                    <th>Specification</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                    <th>Unit Rate</th>
                    <th>Pricing Excluding GST (18%)</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
            {% for sp in data.specification %}
                {% if sp.is_checked %}
                    <tr>
                        <td>{{ sp.sl_no }}</td>
                        <td>{{ sp.specification }}</td>
                        <td>{{ sp.qnty }}</td>
                        <td>{{ sp.unit }}</td>
                        <td>{{ sp.unit_rate }}</td>
                        <td>{{ sp.price_exgst }}</td>
                        <td>{{ sp.total }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    {% if has_terms %}
    <div class="details-section">
        <div class="section-title">Terms and Conditions</div>
        <ul>
            {% for pri in data.terms %}
                {% if pri.is_checked %}
                    <li>{{ pri.text }}</li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if has_general_terms %}
    <div class="details-section">
        <div class="section-title">General Terms and Conditions</div>
        {% for gterms in data.general_terms_conditions %}
            {% if gterms.performance_checked %}
                <h4>Performance</h4>
                <p>{{ gterms.performance_text }}</p>
            {% endif %}
            {% if gterms.flow_characteristics_checked %}
                <h4>Flow and Characteristics</h4>
                <p>{{ gterms.flow_characteristics_text }}</p>
            {% endif %}
            {% if gterms.trial_quality_check_checked %}
                <h4>Trial Run and Quality Check Before Dispatch</h4>
                <p>{{ gterms.trial_quality_check_text }}</p>
            {% endif %}
            {% if gterms.virtual_completion_checked %}
                <h4>Virtual Completion</h4>
                <p>{{ gterms.virtual_completion_text }}</p>
            {% endif %}
            {% if gterms.limitation_liability_checked %}
                <h4>Limitations of Liability</h4>
                <p>{{ gterms.limitation_liability_text }}</p>
            {% endif %}
            {% if gterms.force_clause_checked %}
                <h4>Force Majeure Clause</h4>
                <p>{{ gterms.force_clause_text }}</p>
            {% endif %}
            {% if gterms.additional_works_checked %}
                <h4>Additional Works</h4>
                <p>{{ gterms.additional_works_text }}</p>
            {% endif %}
            {% if gterms.warranty_guaranty_checked %}
                <h4>Warranty/Guarantee</h4>
                <p>{{ gterms.warranty_guaranty_text }}</p>
            {% endif %}
            {% if gterms.arbitration_checked %}
                <h4>Arbitration</h4>
                <p>{{ gterms.arbitration_text }}</p>
            {% endif %}
            {% if gterms.validity_checked %}
                <h4>Validity</h4>
                <p>{{ gterms.validity_text }}</p>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    {% if has_appendix %}
    <div class="details-section">
        <div class="section-title">Appendix A: Scope of Work</div>
        {% if has_appendix_table %}
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Product on Offer</th>
                    <th>Capacity</th>
                    <th>Total Needed Capacity</th>
                    <th>Wastewater Type</th>
                    <th>Total Number of Machines</th>
                </tr>
            </thead>
            <tbody>
            {% for instal in data.installation %}
                {% if instal.is_checked %}
                    <tr>
                        <td>{{ instal.product_name }}</td>
                        <td>{{ instal.capacity }}</td>
                        <td>{{ instal.total_needed_capacity }}</td>
                        <td>{{ instal.waste_water_type }}</td>
                        <td>{{ instal.total_no_machines }}</td>
                    </tr>
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
        {% endif %}
        <br>
        <h4>Inclusions</h4>
        <ul>
            {% if has_supply_eq %}
            <li>
                <b>Supply of Equipment</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.supply_eq_checked %}
                        <li>{{ apen.supply_eq_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
            {% if has_instal_commissioning %}
            <li>
                <b>Installation & Commissioning of Equipment</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.instal_commissioning_checked %}
                        <li>{{ apen.instal_commissioning_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
            {% if has_clients_scope %}
            <li>
                <b>Client's Scope</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.clients_scope_checked %}
                        <li>{{ apen.clients_scope_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
            {% if has_note %}
            <li>
                <b>Note</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.note_checked %}
                        <li>{{ apen.note_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
            {% if has_dristi %}
            <li>
                <b>DRISTI Software Subscription and XHUB</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.dristi_checked %}
                        <li>{{ apen.dristi_subscription_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
            {% if has_iot %}
            <li>
                <b>IOT Hardware</b>
                <ul>
                {% for apen in data.appendix %}
                    {% if apen.iot_checked %}
                        <li>{{ apen.iot_hardware_text }}</li>
                    {% endif %}
                {% endfor %}
                </ul>
            </li>
            {% endif %}
        </ul>
    </div>
    {% endif %}
    <hr>
    <footer>
        <p>Â© Xpredict Labs. All rights reserved.</p>
        <button class="print-button" onclick="window.print()">Print this quotation</button>
    </footer>
</div>
</body>
</html>
